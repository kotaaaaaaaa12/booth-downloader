<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOOTHダウンロードリンク抽出</title>
</head>
<body>
    <h2>BOOTH購入履歴リンク抽出</h2>
    <textarea id="htmlInput" placeholder="購入履歴ページのHTMLをここに貼り付けてください" rows="10" cols="50"></textarea>
    <br>
    <button onclick="extractLinks()">リンクを抽出</button>
    <h3>抽出されたダウンロードリンク:</h3>
    <ul id="linkList"></ul>

    <!-- 一括ダウンロードボタン -->
    <button onclick="downloadAllLinks()">Download All</button>

    <script>
        let links = []; // 抽出されたリンクを格納する配列

        // リンクを抽出する関数
        function extractLinks() {
            const html = document.getElementById("htmlInput").value;
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, "text/html");

            links = [];
            doc.querySelectorAll("a").forEach(a => {
                if (a.href.includes("download")) { // ダウンロードリンクを探す
                    links.push(a.href);
                }
            });

            const linkList = document.getElementById("linkList");
            linkList.innerHTML = ""; // 既存のリストをクリア

            links.forEach(link => {
                const li = document.createElement("li");
                const a = document.createElement("a");
                a.href = link;
                a.textContent = link;
                a.target = "_blank";
                li.appendChild(a);
                linkList.appendChild(li);
            });

            if (links.length === 0) {
                linkList.innerHTML = "<li>ダウンロードリンクが見つかりませんでした</li>";
            }
        }

        // 一括ダウンロード処理を行う関数
        function downloadAllLinks() {
            if (links.length === 0) {
                alert("ダウンロードリンクがありません。まずリンクを抽出してください。");
                return;
            }

            // すべてのリンクを順番にダウンロード
            links.forEach(link => {
                let a = document.createElement('a');
                a.href = link;
                a.download = ''; // ファイル名は指定しない
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });
        }
    </script>
</body>
</html>
